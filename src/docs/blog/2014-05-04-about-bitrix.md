---
title:   "Немного о 1С-Битрикс"
date:    2014-05-04 02:26:00
tags:    ["cms", "hate", "1c"]
layout:  "blog/post"
---

Очередной пост зла. На этот раз речь пойдет о, широко распиареном в корпоративном сегменте, куске говнокода под названием 1С-Битрикс. Пост назревал давно, но я пообещал себе опубликовать его только после релиза проекта. И вот, проект релизнулся, а я готов поделиться яркими, незабываемыми впечатлениями.

<!-- cut -->

Не для кого не секрет, что вовремя посуетившаяся в свое время компания 1С сделала свои программные продукты де-факто стандартом в сегменте корпоративного учета и отчетности.

Веб набирал обороты, всё большее количество торговых организаций обзаводились представительством в интернете. И в 2007 году, прикупив половину акций компании «Битрикс», которая в то время разрабатывала никому ненужную коммерческую CMS, 1С выпустила на рынок приципиально новую E-Commerce платформу, ключевой фишкой которой стала возможность синхронизации базы всей вашей номенклатуры с сайтом одним нажатием кнопки.

Клиент конечно же был несказанно рад такому повороту событий. Тем временем вокруг Битрикса развернули сообщество, ввели сетификацию специалистов, на вражеских форумах маркетологи свистели о том, какой-же он гибкий, мощный и востребованный. В общем, как могли завлекали разработчиков.

Все на первый взгляд хорошо, но на самом деле это просто говно в красивом фантике. Более сатрая и адекватная часть PHP сообщества сейчас всячески травит битриксоидов и желает им девяти кругов ада. На то есть свои причины, которые не так давно осознал и я.

## Проблема 1: Нужно больше золота

Суть в том, что вся работа вокруг Битрикса построена на деньгах и только на них. Здесь вы никогда не увидите разработчика-энтузиаста, тщательно полирующего свой код. Каждая строчка кода, каждый байт, да вся и политика в целом — все создано и написано ради получения прибыли разработчиками и партнерами.

Студии выбирают Битрикс далеко не за удобство и гибкость а за партнерские привилегии. В частности они получают халявную версию Битрикса, если продают определенное количество лицензий в год, а так же получают не маленький процент с самих продаж. Учитывая спрос, все это дело очень прибыльно.

Клиент же, в случае если свяжется с Битриксом, обрекает себя на вечные и неоправданные капиталовложения или, говоря русским языком, становится лохом которого «доят». Деньги из покупателя CMS будут тянуть всеми возможными способами, начиная от банальной **ежегодной подписки** на обновления и техподдержку, заканчивая покупкой **дополнительной лицензии** для тестовой версии сайта.

## Проблема 2: Универсальность

Будучи платформой широкого применения Битрикс старается быть как можно более универсальным. Полторы сотни компонентов на все случаи жизни, от банального каталога до всяких корпоративных блогов с рейтингами и кармой. Большая часть из этого — просто мусор, который никогда не будет использоваться.

Чистая система занимает на диске около гигабайта, что неоправданно много. Количество файлов там порядка сорока тысяч.

Так же, универсальности способствует система инфоблоков, по сути являющихся реляционной базой данных поверх реляционной базы данных.

Тормознутость системы, о которой все говорят, кроется именно здесь. Сам инфоблок — это таблица. Свойство инфоблока — это, соответственно, поле. Причем сущности эти виртуальные, которые хранятся в таблицах самого битрикса.

Для хранения каких-то единичных и независимых данных это очень даже неплохое решение. Но к несчастью, это единственный законный способ хранения любой информации. Еще более к несчастью, инфоблоки умеют реляционную алгебру и часто возникает необходимость ее применения.

Любой мало мальски сложный запрос с зависимостями инфоблоков заставит ваш MySQL-сервер сильно удивиться: 20-30 джоинов одной и той-же таблицы в одном запросе это далеко не страшилки для архитекторов баз, а суровая реальность.

## Проблема 3: Интуитивность

Это был мой первый случай когда для того чтобы разобраться в интерфейсе пришлось прочитать 600 страниц документации. Админка сделана в лучших традиция 1С, это видимо у них семейное. Все красиво свистит и переливается, на этом плюсы заканчиваются.

На поиски одной задрипанной галочки в настройках может запросто уйти минут 20. И причина может быть даже не в том, что разделов с настройками там более чем дохрена и находятся они в разных концах системы, причина может быть в очень абстрактных названиях опций.

Но это еще половина беды. В некоторых случаях система себя ведет как маленькая девочка, выкидывая совершенно неожиданные, нелогичные и необъяснимые фокусы. Благодаря уникальной российской нанотехнологии под названием «отложенные функции», в заголовке страницы может появиться что угодно, но только не то, что вам нужно, только потому, что какой-то компонент считает себя самым умным и пишет туда что хочет. А благодаря архитектуре вы хрен найдете то место, где ваше значение переписывается.

## Проблема 4: Архитектура и говнокод

Судя по отзывам блоггеров, одним из самых частых доводов при отказе от Битрикса является именно говнокод. Они не шутят, говнокод здесь чистейший, можно даже сказать эталонный.

Начнем с того, что вся структура строится на старом, бородатом подходе «одна страница — один PHP файл». В каждый файл инклудятся header и footer, а между ними размещается контент. Чуете чем пахнет? Можество точек входа, корявый роутинг через запись значений в `$_REQUEST`, рваные шаблоны, и никакого вам MVC.

Да, HTML разметка, контент, запросы к ORM и логика будет прямо в одном файле, как в старые добрые времена.

Намек на разделение кода все-же есть, называется он «компонент» и представляет собой ни что иное как паттерн «виджет». В теле страницы вызывается специальная функция с именем компонента и массивом параметров, а он в свою очередь кастует магию где-то у себя в недрах и отдает HTML.

Ок, логичное решение, для подобной архитектуры. При таком подходе можно представить что ты пишешь не под Битрикс и хотя-бы код компонентов привести в порядок. А вот хрен, там дела еще хуже: шаблоны стандартных компонентов все так-же набиты логикой, вашим любимым `echo` и даже вызовами других компонентов (которые в свою очередь вызывают другие компоненты), таким образом получается еще более неочевидная и запутанная фигня.

Ядро тоже не отличается изяществом. Это такая помойка из классов, с редкими вкраплениями комментариев то на русском, то на английском языке. Там нет ни единой аннотации к методу, никакого PHPDoc! Можешь нафиг выбросить свою навороченную IDE с анализаторм кода и писать все в блокноте.

Code style битрикса ничего общего с тем, как пишут нормальные люди, не имеет. Это касается как кода на PHP так и на JavaScript. Не будем даже обращать внимание на странную расстановку фигурных скобок, на странные имена методов, на то, что все переменные и ключи массивов названы в апперкейсе, у вас и без этого будет что вспомнить. Мне лично больше всего запомнились двойные кавычки везде, абсолютно везде. Я ничего не имею против самих кавычек, но в перемешку с HTML внутри атрибута двойная кавычка может запросто сломать подсветку синтаксиса.

## Проблема 5: Управление контентом

В предыдущем пункте я рассказывал, что контент и логика зачастую располагаются в одном файле. Как думаете, как будет выглядеть процесс правки контента в таком файле? Угадали, шанс зацепить логику при правке составляет примерно 146%. 

Не подумайте, я не из тех, кто думает, что с управлением сложной системой должна справляться обезьяна. Зато я из тех, кто знает, что человек, занимающийся контентом и человек, занимающийся кодом — это разные люди зачастую разных квалификаций, поэтому данные и логика должны находиться в разных частях галактики и никак друг на друга не влиять.

В некоторых случаях проблему можно разрешить с помощью так называемых «включаемых областей». Почему в некоторых? На каждый чих этих областей понаписать нельзя, на одних страницах может быть несколько колонок, на других их не быть совсем. Без разметки в файле с контентом обойтись сложно, а вот прострелить себе ногу становится проще.

## Заключение

Это далеко не все, до чего можно докопаться. Проблем действительно много, все они имеют место быть и очень раздражать как разработчиков так и обслуживающий персонал. Благодаря им писать под Битрикс становится просто неприятно. Если ты, дорогой читатель, пришел сюда за ответом, стоит ли браться за проект на этой CMS, то я бы сказал, что нет.

— «Но ведь есть крупные и успешные сайты на Битриксе!» Да, действительно есть. Я не говорил, что на Битриксе нельзя сделать что-то работающее. Но доведение такого проекта до ума потребует просто огромных затрат, кучу времени и далеко не одного специалиста. Причем затраты эти будут даже зачастую больше затрат на разработку своего решения.

При покупке 1С-Битрикс нужно четко осознавать, что это в первую очередь коммерческий продукт, то бишь продукт, созданный для зарабатывания денег его авторами и партнерами, а уже только потом инструмент для решения ваших задач. Так же перед покупкой попробуйте задать себе вопрос: «Почему именно Битрикс? Что он может из того, что не могут другие решения?» Если ответом будет что-то из области: «У Коляна тоже Битрикс» и «У нас бухгалтерша 1С знает», то скорее всего это не ваш выбор.
