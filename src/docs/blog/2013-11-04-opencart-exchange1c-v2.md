---
title:  "OpenCart Exchange1C 2.0"
date:   2013-11-04 11:06:00
tags:   ["opencart", "1c", "parsers"]
layout: "blog/post"
---

Прошло довольно много времени с момента последнего обновления модуля обмена данными между OpenCart и 1С. Сайт с документацией лежал и все потихоньку разваливалось. Что ж, пришло время переписать все по взрослому и рассказать тем, кто задает слишком много вопросов мне в ящик о приближающейся второй версии Exchange1C. Что это все значит? Давайте взглянем.

<!-- cut -->

Начнем, наверное, с главного. На момент написания поста, модуль еще не готов. Готова примерно половина запланированного функционала, а все озвученное здесь лишь выжимка из плана.

## Схемы данных

Схемы — одно из основных нововведений второй версии, они позволяют безболезненно менять логику обмена данными и добавлять новые, не затрагивая ядро. По сути, схема — это json файл с описанием всех полей в карточке товара opencart и некоторых правил для них. В частности, там указывается, какое поле из xml файла соответствует полю в магазине, и что делать, при приходе новых данных: перезаписывать или оставлять как есть.

## Система плагинов

Плагин для плагина, наверное смешно звучит, однако это суровая реальность. Плагины позволяют нам оперировать любыми данными в момент импорта, опять же, никак не затрагивая ядро. Все это происходит с помощью системы событий. В плагине описывается событие, по которому будет вызываться та или иная его функция и в зависимости от события в функцию передаются некоторые параметры. Массивы с данными передаются ссылкой, поэтому, с помощью плагина мы можем легко изменять то, что нам нужно при каких-нибудь условиях. В стандартной поставке идет плагин, который генерирует SEO URL при создании категории или товара.

## Ядро

Ядро обзавелось отдельным набором классов где-то в `/system/third_party/exchange1c/`. Теоретически, оно должно быть сделано так, чтобы никто никогда его не трогал, а манипуляции производил сугубо через плагины и правки схем. Идеально сделать это, конечно, вряд-ли получится, особо требовательным людям все же придется туда сходить, но большую часть мелочей нужно будет делать именно через плагины.

Ядро изолировано от других частей модуля и обновляется отдельно (вернее только оно и обновляется) все настроенные схемы и написанные плагины сохраняются и используются как и раньше (возможно, с незначительными измененениями, совместимость будем стараться не ломать).

## Техническая поддержка

Это не столько относится к модулю, сколько к помощи по работе с ним. Одна крутая веб-студия согласилась таки помочь. Техподдержка и допил под желания заказчика теперь будет производиться в официальном порядке, со всеми договорами и прочими удобствами юридической стороны вопроса. Никакого фриланса по вечерам и просерания дедлайна. После сдачи вы все так же получаете собственную версию модуля и patch файл для самостоятельного внесения изменений в последующие версии, если вдруг захотите обновиться.

Сам же я дико извиняюсь перед всеми, с кем не смог поработать, предложений было слишком много. И так же, отдельно извиняюсь за потерянную при переезде на другой сервер документацию к старой версии модуля.

## Совместимость

Был сознательно нарушен code style опенкатра, дабы не ломать глаза об спагетти (спорный минус).

Из за зоопарка версий протоколов обмена в разных версиях конфигураций 1С, будет поддерживаться только один — последний. Инструкции по обновлению, конечно же, в стороне не останутся (еще раз: **конфигурацию обновлять не нужно**, только обработку обмена данными).

Для работы модуля требуется php 5.3+ (есть везде, но может не везде включен) ибо задействованы специфичные для него фичи (автор долгое время работал с symfony2 и laravel 4, не отпустило). Тем, у кого ниже, придется обновится. Старая версия, как php, так и самого модуля, больше поддерживаться не будет и остается на растерзание сообществу.

Насчет поддержки версий опенкарта — пока сложно что-либо сказать. Пока будем ориентироваться на последний ocStore, по мере надобности будем так-же подключать и старые версии, на которых модуль не заведется (либо апгрейдтить их на новые).

## Лицензия

Модуль останется все тем же бесплатным, с открытым исходным кодом, опубликованным под GPLv3, однако, к этому возможно добавится коммерческая лицензия для веб-студий.

## В заключение

Конечно, к моменту релиза, все, описанное здесь может немного измениться, т.к. идей и педложений будет много. А эта заметка этакий анонс того, чего стоит ждать. Весь процесс разработки можно наблюдать на [GitHub](https://github.com/zenwalker/opencart-exchange1c/tree/2.0-dev).
